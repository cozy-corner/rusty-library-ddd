# Rusty Library DDD - プロジェクト概要

## はじめに

このプロジェクトは、公立図書館管理システムを題材に**関数型ドメイン駆動設計（Functional DDD）**を実践的に学ぶための学習プロジェクトです。

## プロジェクトの目的

### 最優先：関数型DDDの実践的な学習

**関数型DDDとは：**

ドメイン駆動設計の概念を、関数型プログラミングのパラダイムで実装するアプローチ。

**従来のOOP的DDDとの主な違い：**

| 観点 | OOP的DDD | 関数型DDD |
|------|----------|-----------|
| 集約 | クラス（状態を持つ） | 純粋関数 + データ構造 |
| 振る舞い | メソッド（状態を変更） | 関数（新しい状態を返す） |
| 副作用 | オブジェクト内に混在 | 境界で分離 |
| 不変性 | 可変（setter） | イミュータブル |

OOP的DDDでは集約が状態を持ち、メソッドで状態を変更します。関数型DDDでは、純粋関数が現在の状態を受け取り、新しい状態を返します。副作用は境界で明確に分離されます。

### 学ぶべき主要な概念

**関数型プログラミング：**
- 純粋関数
- イミュータビリティ
- 副作用の分離
- Result型によるエラーハンドリング

**DDD（戦略的・戦術的設計）：**
- 境界づけられたコンテキスト
- ユビキタス言語
- 集約、値オブジェクト
- ドメインイベント

**イベントソーシング：**
- イベント中心の設計
- 状態の復元（fold/reduce）
- CQRS

## システム概要

### ドメイン

公立図書館の貸出・予約管理システム

**主要な機能：**
- 書籍の貸出・延長・返却
- 延滞管理
- 書籍の予約・予約管理

**ビジネス制約：**
- 延滞料金なし（公立図書館）
- 貸出上限：5冊
- 貸出期間：2週間
- 延長：1回のみ

### コンテキストマップ

```
【Core Domain】
┌──────────────┐       ┌──────────────┐
│  貸出管理     │◄─────►│  予約管理     │
└──────┬───────┘       └──────┬───────┘
       │ ポート経由            │
       ↓                      ↓
【Sub Domain】
┌──────────┐  ┌──────────┐  ┌──────────┐
│ 会員管理  │  │カタログ  │  │ 職員管理  │
└──────────┘  └──────────┘  └──────────┘
```

**各コンテキストは：**
- 独立したドメインモデル（純粋関数の集まり）
- 独自のユビキタス言語
- ポート（トレイト）経由でのみ協調

## 技術選定

### 言語：Rust

**関数型DDDに適している理由：**
- イミュータビリティがデフォルト
- 強力な型システム
- Result型によるエラーハンドリング
- トレイトシステム（ポート設計に最適）
- 所有権システム（副作用の制御）

### アーキテクチャ：ヘキサゴナルアーキテクチャ

ドメイン層を純粋関数に保ち、副作用をアダプター層に分離します。

```
Adapters (副作用)
    ↓ トレイト（ポート）
Application Layer (副作用の実行)
    ↓ 純粋関数を呼ぶ
Domain Layer (純粋関数のみ)
```

### イベントソーシング + CQRS

**関数型DDDとの相性：**
- イベント = イミュータブル
- 状態復元 = fold/reduce
- 決定と実行の明確な分離

## 実装フェーズ

**Phase 1: 貸出管理**
- 関数型DDDの基礎
- 純粋関数によるドメインモデル

**Phase 2: 予約管理**
- 関数型パターンの応用

**Phase 3: コンテキスト統合**
- ポートによる疎結合

**Phase 4: サブドメイン**
- パターンの確立

## 学習の進め方

### 推奨する順序

1. 関数型DDDの基礎 - 純粋関数、イミュータビリティ
2. 型で表現するビジネスルール - 型駆動設計
3. イベントソーシング - fold/reduce、状態復元
4. アーキテクチャ統合 - ヘキサゴナル、ポート&アダプター

### 重要な学習ポイント

**注目すべきこと：**
- 純粋関数でドメインロジックを表現する方法
- 型でビジネスルールを強制する方法
- 副作用を境界で分離する方法

**技術詳細に囚われない：**
- データベースの実装
- フレームワークの使い方
- パフォーマンスチューニング

関数型DDDの思想を理解することが最優先です。

## イベントストーミングとの関係

このプロジェクトは、事前に実施したイベントストーミング（Big Picture）で洗い出したドメインイベントを、関数型DDDで実装します。

**Big Picture → 実装の対応：**
- ドメインイベント（黄色付箋）→ イミュータブルなEvent struct
- コマンド（青色付箋）→ Command struct
- ポリシー（紫色付箋）→ イベントハンドラー
- コンテキスト境界（線）→ モジュール分割、ポート

## ドキュメント構成

**全体設計ドキュメント：**
- `01_overview.md` - プロジェクト概要
- `02_domain_model.md` - 関数型で表現するドメインモデル
- `03_context_boundaries.md` - ポートによるコンテキスト分離
- `04_commands_events.md` - イミュータブルなコマンドとイベント
- `05_implementation.md` - 関数型DDDの実装パターン
- `06_event_sourcing.md` - fold/reduceによる状態復元

**Phase別実装仕様：**
- `phases/phase1_loan_management.md` - Phase 1実装仕様書
